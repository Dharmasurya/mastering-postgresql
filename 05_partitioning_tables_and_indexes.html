
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Partitioning Tables and Indexes &#8212; My Jupyter Book</title>
    
  <link rel="stylesheet" href="_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.2d2078699c18a0efb88233928e1cf6ed.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.be0a4a0c39cd630af62a2fcf693f3f06.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Pre-Defined Functions" href="06_predefined_functions.html" />
    <link rel="prev" title="Creating Tables and Indexes" href="04_creating_tables_and_indexes.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  
  <h1 class="site-logo" id="site-title">My Jupyter Book</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="mastering-postgresql.html">
   Mastering Postgresql
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="01_getting_started.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_writing_basic_sql_queries.html">
   Writing Basic SQL Queries
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_creating_tables_and_indexes.html">
   Creating Tables and Indexes
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Partitioning Tables and Indexes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_predefined_functions.html">
   Pre-Defined Functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_writing_advanced_sql_queries.html">
   Writing Advanced SQL Queries
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/05_partitioning_tables_and_indexes.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/05_partitioning_tables_and_indexes.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#overview-of-partitioning">
   Overview of Partitioning
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#list-partitioning">
   List Partitioning
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#adding-partitions">
   Adding Partitions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#inserting-data">
   Inserting Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dropping-partitions">
   Dropping Partitions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#managing-indexes">
   Managing Indexes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#range-partitioning">
   Range Partitioning
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#hash-partitioning">
   Hash Partitioning
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#usage-scenarios">
   Usage Scenarios
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="partitioning-tables-and-indexes">
<h1>Partitioning Tables and Indexes<a class="headerlink" href="#partitioning-tables-and-indexes" title="Permalink to this headline">¶</a></h1>
<p>As part of this section we will primarily talk about partitioning tables as well as indexes.</p>
<ul class="simple">
<li><p>Overview of Partitioning</p></li>
<li><p>List Partitioning</p></li>
<li><p>Adding Partitions</p></li>
<li><p>Inserting Data</p></li>
<li><p>Dropping Partitions</p></li>
<li><p>Managing Indexes</p></li>
<li><p>Range Partitioning</p></li>
<li><p>Hash Partitioning</p></li>
<li><p>Usage Scenarios</p></li>
</ul>
<div class="section" id="overview-of-partitioning">
<h2>Overview of Partitioning<a class="headerlink" href="#overview-of-partitioning" title="Permalink to this headline">¶</a></h2>
<p>Most of the modern database technologies support wide variety of partitioning strategies. However, here are the most commonly used ones.</p>
<ul class="simple">
<li><p>List Partitioning</p></li>
<li><p>Range Partitioning</p></li>
<li><p>Hash Partitioning</p></li>
<li><p>List and Range are more widely used compared to Hash Partitioning.</p></li>
<li><p>We can also mix and match these to have multi level partitioning. It is known as sub partitioning.</p></li>
<li><p>We can only partition a table with primary key when partition column is prime attribute (one of the primary key columns).</p></li>
</ul>
</div>
<div class="section" id="list-partitioning">
<h2>List Partitioning<a class="headerlink" href="#list-partitioning" title="Permalink to this headline">¶</a></h2>
<p>Let us understand how we can take care of list partitioning of tables.</p>
<ul class="simple">
<li><p>It is primarily used to create partitions based up on the values.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> sql
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">env</span> DATABASE_URL=postgresql://itversity_sms_user:sms_password@localhost:5432/itversity_sms_db
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">sql</span> DROP TABLE IF EXISTS users
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

CREATE TABLE users (
    user_id SERIAL PRIMARY KEY,
    user_first_name VARCHAR(30) NOT NULL,
    user_last_name VARCHAR(30) NOT NULL,
    user_email_id VARCHAR(50) NOT NULL,
    user_email_validated BOOLEAN DEFAULT FALSE,
    user_password VARCHAR(200),
    user_role VARCHAR(1) NOT NULL DEFAULT &#39;U&#39;, --U and A
    is_active BOOLEAN DEFAULT FALSE,
    created_dt DATE DEFAULT CURRENT_DATE,
    last_updated_ts TIMESTAMP DEFAULT CURRENT_TIMESTAMP
)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">sql</span> DROP TABLE IF EXISTS users_part
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

CREATE TABLE users_part (
    user_id SERIAL,
    user_first_name VARCHAR(30) NOT NULL,
    user_last_name VARCHAR(30) NOT NULL,
    user_email_id VARCHAR(50) NOT NULL,
    user_email_validated BOOLEAN DEFAULT FALSE,
    user_password VARCHAR(200),
    user_role VARCHAR(1) NOT NULL DEFAULT &#39;U&#39;, --U and A
    is_active BOOLEAN DEFAULT FALSE,
    created_dt DATE DEFAULT CURRENT_DATE,
    last_updated_ts TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (user_role, user_id)
) PARTITION BY LIST(user_role)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">sql</span> DROP TABLE IF EXISTS users_mthly_part
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://itversity_sms_user:***@localhost:5432/itversity_sms_db
Done.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

CREATE TABLE users_mthly_part (
    user_id SERIAL,
    user_first_name VARCHAR(30) NOT NULL,
    user_last_name VARCHAR(30) NOT NULL,
    user_email_id VARCHAR(50) NOT NULL,
    user_email_validated BOOLEAN DEFAULT FALSE,
    user_password VARCHAR(200),
    user_role VARCHAR(1) NOT NULL DEFAULT &#39;U&#39;, --U and A
    is_active BOOLEAN DEFAULT FALSE,
    created_dt DATE DEFAULT CURRENT_DATE,
    created_mnth INT,
    last_updated_ts TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) PARTITION BY LIST(created_mnth)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://itversity_sms_user:***@localhost:5432/itversity_sms_db
Done.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">sql</span> ALTER TABLE users_mthly_part ADD PRIMARY KEY (created_mnth, user_id)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://itversity_sms_user:***@localhost:5432/itversity_sms_db
Done.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

SELECT table_name, column_name, ordinal_position, is_nullable 
FROM information_schema.columns
WHERE table_name = &#39;users_mthly_part&#39;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://itversity_sms_user:***@localhost:5432/itversity_sms_db
11 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <tr>
        <th>table_name</th>
        <th>column_name</th>
        <th>ordinal_position</th>
        <th>is_nullable</th>
    </tr>
    <tr>
        <td>users_mthly_part</td>
        <td>user_id</td>
        <td>1</td>
        <td>NO</td>
    </tr>
    <tr>
        <td>users_mthly_part</td>
        <td>user_first_name</td>
        <td>2</td>
        <td>NO</td>
    </tr>
    <tr>
        <td>users_mthly_part</td>
        <td>user_last_name</td>
        <td>3</td>
        <td>NO</td>
    </tr>
    <tr>
        <td>users_mthly_part</td>
        <td>user_email_id</td>
        <td>4</td>
        <td>NO</td>
    </tr>
    <tr>
        <td>users_mthly_part</td>
        <td>user_email_validated</td>
        <td>5</td>
        <td>YES</td>
    </tr>
    <tr>
        <td>users_mthly_part</td>
        <td>user_password</td>
        <td>6</td>
        <td>YES</td>
    </tr>
    <tr>
        <td>users_mthly_part</td>
        <td>user_role</td>
        <td>7</td>
        <td>NO</td>
    </tr>
    <tr>
        <td>users_mthly_part</td>
        <td>is_active</td>
        <td>8</td>
        <td>YES</td>
    </tr>
    <tr>
        <td>users_mthly_part</td>
        <td>created_dt</td>
        <td>9</td>
        <td>YES</td>
    </tr>
    <tr>
        <td>users_mthly_part</td>
        <td>created_mnth</td>
        <td>10</td>
        <td>NO</td>
    </tr>
    <tr>
        <td>users_mthly_part</td>
        <td>last_updated_ts</td>
        <td>11</td>
        <td>YES</td>
    </tr>
</table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

INSERT INTO users_mthly_part (user_first_name, user_last_name, user_email_id)
VALUES 
    (&#39;Scott&#39;, &#39;Tiger&#39;, &#39;scott@tiger.com&#39;),
    (&#39;Donald&#39;, &#39;Duck&#39;, &#39;donald@duck.com&#39;),
    (&#39;Mickey&#39;, &#39;Mouse&#39;, &#39;mickey@mouse.com&#39;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://itversity_sms_user:***@localhost:5432/itversity_sms_db
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">CheckViolation</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="nn">/opt/anaconda3/envs/beakerx/lib/python3.6/site-packages/sqlalchemy/engine/base.py</span> in <span class="ni">_execute_context</span><span class="nt">(self, dialect, constructor, statement, parameters, *args)</span>
<span class="g g-Whitespace">   </span><span class="mi">1276</span>                     <span class="bp">self</span><span class="o">.</span><span class="n">dialect</span><span class="o">.</span><span class="n">do_execute</span><span class="p">(</span>
<span class="ne">-&gt; </span><span class="mi">1277</span>                         <span class="n">cursor</span><span class="p">,</span> <span class="n">statement</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">context</span>
<span class="g g-Whitespace">   </span><span class="mi">1278</span>                     <span class="p">)</span>

<span class="nn">/opt/anaconda3/envs/beakerx/lib/python3.6/site-packages/sqlalchemy/engine/default.py</span> in <span class="ni">do_execute</span><span class="nt">(self, cursor, statement, parameters, context)</span>
<span class="g g-Whitespace">    </span><span class="mi">592</span>     <span class="k">def</span> <span class="nf">do_execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cursor</span><span class="p">,</span> <span class="n">statement</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">593</span>         <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">594</span> 

<span class="ne">CheckViolation</span>: no partition of relation &quot;users_mthly_part&quot; found for row
<span class="ne">DETAIL</span>:  Partition key of the failing row contains (created_mnth) = (null).


<span class="n">The</span> <span class="n">above</span> <span class="n">exception</span> <span class="n">was</span> <span class="n">the</span> <span class="n">direct</span> <span class="n">cause</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">exception</span><span class="p">:</span>

<span class="ne">IntegrityError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">115</span><span class="o">-</span><span class="mi">0</span><span class="n">d0826ad07a6</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">run_cell_magic</span><span class="p">(</span><span class="s1">&#39;sql&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">INSERT INTO users_mthly_part (user_first_name, user_last_name, user_email_id)</span><span class="se">\n</span><span class="s2">VALUES </span><span class="se">\n</span><span class="s2">    (&#39;Scott&#39;, &#39;Tiger&#39;, &#39;scott@tiger.com&#39;),</span><span class="se">\n</span><span class="s2">    (&#39;Donald&#39;, &#39;Duck&#39;, &#39;donald@duck.com&#39;),</span><span class="se">\n</span><span class="s2">    (&#39;Mickey&#39;, &#39;Mouse&#39;, &#39;mickey@mouse.com&#39;)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nn">/opt/anaconda3/envs/beakerx/lib/python3.6/site-packages/IPython/core/interactiveshell.py</span> in <span class="ni">run_cell_magic</span><span class="nt">(self, magic_name, line, cell)</span>
<span class="g g-Whitespace">   </span><span class="mi">2369</span>             <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">builtin_trap</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">2370</span>                 <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">magic_arg_s</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">2371</span>                 <span class="n">result</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2372</span>             <span class="k">return</span> <span class="n">result</span>
<span class="g g-Whitespace">   </span><span class="mi">2373</span> 

<span class="nn">&lt;decorator-gen-135&gt;</span> in <span class="ni">execute</span><span class="nt">(self, line, cell, local_ns)</span>

<span class="nn">/opt/anaconda3/envs/beakerx/lib/python3.6/site-packages/IPython/core/magic.py</span> in <span class="ni">&lt;lambda&gt;</span><span class="nt">(f, *a, **k)</span>
<span class="g g-Whitespace">    </span><span class="mi">185</span>     <span class="c1"># but it&#39;s overkill for just that one bit of state.</span>
<span class="g g-Whitespace">    </span><span class="mi">186</span>     <span class="k">def</span> <span class="nf">magic_deco</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">187</span>         <span class="n">call</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">:</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">188</span> 
<span class="g g-Whitespace">    </span><span class="mi">189</span>         <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>

<span class="nn">&lt;decorator-gen-134&gt;</span> in <span class="ni">execute</span><span class="nt">(self, line, cell, local_ns)</span>

<span class="nn">/opt/anaconda3/envs/beakerx/lib/python3.6/site-packages/IPython/core/magic.py</span> in <span class="ni">&lt;lambda&gt;</span><span class="nt">(f, *a, **k)</span>
<span class="g g-Whitespace">    </span><span class="mi">185</span>     <span class="c1"># but it&#39;s overkill for just that one bit of state.</span>
<span class="g g-Whitespace">    </span><span class="mi">186</span>     <span class="k">def</span> <span class="nf">magic_deco</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">187</span>         <span class="n">call</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">:</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">188</span> 
<span class="g g-Whitespace">    </span><span class="mi">189</span>         <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>

<span class="nn">/opt/anaconda3/envs/beakerx/lib/python3.6/site-packages/sql/magic.py</span> in <span class="ni">execute</span><span class="nt">(self, line, cell, local_ns)</span>
<span class="g g-Whitespace">    </span><span class="mi">215</span> 
<span class="g g-Whitespace">    </span><span class="mi">216</span>         <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">217</span>             <span class="n">result</span> <span class="o">=</span> <span class="n">sql</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">parsed</span><span class="p">[</span><span class="s2">&quot;sql&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">,</span> <span class="n">user_ns</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">218</span> 
<span class="g g-Whitespace">    </span><span class="mi">219</span>             <span class="k">if</span> <span class="p">(</span>

<span class="nn">/opt/anaconda3/envs/beakerx/lib/python3.6/site-packages/sql/run.py</span> in <span class="ni">run</span><span class="nt">(conn, sql, config, user_namespace)</span>
<span class="g g-Whitespace">    </span><span class="mi">365</span>             <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">366</span>                 <span class="n">txt</span> <span class="o">=</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">367</span>                 <span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span> <span class="n">user_namespace</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">368</span>             <span class="n">_commit</span><span class="p">(</span><span class="n">conn</span><span class="o">=</span><span class="n">conn</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">369</span>             <span class="k">if</span> <span class="n">result</span> <span class="ow">and</span> <span class="n">config</span><span class="o">.</span><span class="n">feedback</span><span class="p">:</span>

<span class="nn">/opt/anaconda3/envs/beakerx/lib/python3.6/site-packages/sqlalchemy/engine/base.py</span> in <span class="ni">execute</span><span class="nt">(self, object_, *multiparams, **params)</span>
<span class="g g-Whitespace">   </span><span class="mi">1009</span>             <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1010</span>         <span class="k">else</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1011</span>             <span class="k">return</span> <span class="n">meth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiparams</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1012</span> 
<span class="g g-Whitespace">   </span><span class="mi">1013</span>     <span class="k">def</span> <span class="nf">_execute_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">multiparams</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>

<span class="nn">/opt/anaconda3/envs/beakerx/lib/python3.6/site-packages/sqlalchemy/sql/elements.py</span> in <span class="ni">_execute_on_connection</span><span class="nt">(self, connection, multiparams, params)</span>
<span class="g g-Whitespace">    </span><span class="mi">296</span>     <span class="k">def</span> <span class="nf">_execute_on_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span> <span class="n">multiparams</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">297</span>         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">supports_execution</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">298</span>             <span class="k">return</span> <span class="n">connection</span><span class="o">.</span><span class="n">_execute_clauseelement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiparams</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">299</span>         <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">300</span>             <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ObjectNotExecutableError</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<span class="nn">/opt/anaconda3/envs/beakerx/lib/python3.6/site-packages/sqlalchemy/engine/base.py</span> in <span class="ni">_execute_clauseelement</span><span class="nt">(self, elem, multiparams, params)</span>
<span class="g g-Whitespace">   </span><span class="mi">1128</span>             <span class="n">distilled_params</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1129</span>             <span class="n">compiled_sql</span><span class="p">,</span>
<span class="ne">-&gt; </span><span class="mi">1130</span>             <span class="n">distilled_params</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1131</span>         <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1132</span>         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_events</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">_has_events</span><span class="p">:</span>

<span class="nn">/opt/anaconda3/envs/beakerx/lib/python3.6/site-packages/sqlalchemy/engine/base.py</span> in <span class="ni">_execute_context</span><span class="nt">(self, dialect, constructor, statement, parameters, *args)</span>
<span class="g g-Whitespace">   </span><span class="mi">1315</span>         <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1316</span>             <span class="bp">self</span><span class="o">.</span><span class="n">_handle_dbapi_exception</span><span class="p">(</span>
<span class="ne">-&gt; </span><span class="mi">1317</span>                 <span class="n">e</span><span class="p">,</span> <span class="n">statement</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">cursor</span><span class="p">,</span> <span class="n">context</span>
<span class="g g-Whitespace">   </span><span class="mi">1318</span>             <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1319</span> 

<span class="nn">/opt/anaconda3/envs/beakerx/lib/python3.6/site-packages/sqlalchemy/engine/base.py</span> in <span class="ni">_handle_dbapi_exception</span><span class="nt">(self, e, statement, parameters, cursor, context)</span>
<span class="g g-Whitespace">   </span><span class="mi">1509</span>             <span class="k">elif</span> <span class="n">should_wrap</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1510</span>                 <span class="n">util</span><span class="o">.</span><span class="n">raise_</span><span class="p">(</span>
<span class="ne">-&gt; </span><span class="mi">1511</span>                     <span class="n">sqlalchemy_exception</span><span class="p">,</span> <span class="n">with_traceback</span><span class="o">=</span><span class="n">exc_info</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">from_</span><span class="o">=</span><span class="n">e</span>
<span class="g g-Whitespace">   </span><span class="mi">1512</span>                 <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1513</span>             <span class="k">else</span><span class="p">:</span>

<span class="nn">/opt/anaconda3/envs/beakerx/lib/python3.6/site-packages/sqlalchemy/util/compat.py</span> in <span class="ni">raise_</span><span class="nt">(***failed resolving arguments***)</span>
<span class="g g-Whitespace">    </span><span class="mi">180</span> 
<span class="g g-Whitespace">    </span><span class="mi">181</span>         <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">182</span>             <span class="k">raise</span> <span class="n">exception</span>
<span class="g g-Whitespace">    </span><span class="mi">183</span>         <span class="k">finally</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">184</span>             <span class="c1"># credit to</span>

<span class="nn">/opt/anaconda3/envs/beakerx/lib/python3.6/site-packages/sqlalchemy/engine/base.py</span> in <span class="ni">_execute_context</span><span class="nt">(self, dialect, constructor, statement, parameters, *args)</span>
<span class="g g-Whitespace">   </span><span class="mi">1275</span>                 <span class="k">if</span> <span class="ow">not</span> <span class="n">evt_handled</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1276</span>                     <span class="bp">self</span><span class="o">.</span><span class="n">dialect</span><span class="o">.</span><span class="n">do_execute</span><span class="p">(</span>
<span class="ne">-&gt; </span><span class="mi">1277</span>                         <span class="n">cursor</span><span class="p">,</span> <span class="n">statement</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">context</span>
<span class="g g-Whitespace">   </span><span class="mi">1278</span>                     <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1279</span> 

<span class="nn">/opt/anaconda3/envs/beakerx/lib/python3.6/site-packages/sqlalchemy/engine/default.py</span> in <span class="ni">do_execute</span><span class="nt">(self, cursor, statement, parameters, context)</span>
<span class="g g-Whitespace">    </span><span class="mi">591</span> 
<span class="g g-Whitespace">    </span><span class="mi">592</span>     <span class="k">def</span> <span class="nf">do_execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cursor</span><span class="p">,</span> <span class="n">statement</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">593</span>         <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">594</span> 
<span class="g g-Whitespace">    </span><span class="mi">595</span>     <span class="k">def</span> <span class="nf">do_execute_no_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cursor</span><span class="p">,</span> <span class="n">statement</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

<span class="ne">IntegrityError</span>: (psycopg2.errors.CheckViolation) no partition of relation &quot;users_mthly_part&quot; found for row
<span class="ne">DETAIL</span>:  Partition key of the failing row contains (created_mnth) = (null).

<span class="p">[</span><span class="n">SQL</span><span class="p">:</span> <span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">users_mthly_part</span> <span class="p">(</span><span class="n">user_first_name</span><span class="p">,</span> <span class="n">user_last_name</span><span class="p">,</span> <span class="n">user_email_id</span><span class="p">)</span>
<span class="n">VALUES</span> 
    <span class="p">(</span><span class="s1">&#39;Scott&#39;</span><span class="p">,</span> <span class="s1">&#39;Tiger&#39;</span><span class="p">,</span> <span class="s1">&#39;scott@tiger.com&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;Donald&#39;</span><span class="p">,</span> <span class="s1">&#39;Duck&#39;</span><span class="p">,</span> <span class="s1">&#39;donald@duck.com&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;Mickey&#39;</span><span class="p">,</span> <span class="s1">&#39;Mouse&#39;</span><span class="p">,</span> <span class="s1">&#39;mickey@mouse.com&#39;</span><span class="p">)]</span>
<span class="p">(</span><span class="n">Background</span> <span class="n">on</span> <span class="n">this</span> <span class="n">error</span> <span class="n">at</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">sqlalche</span><span class="o">.</span><span class="n">me</span><span class="o">/</span><span class="n">e</span><span class="o">/</span><span class="mi">13</span><span class="o">/</span><span class="n">gkpj</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

INSERT INTO users_mthly_part 
    (user_first_name, user_last_name, user_email_id, created_dt, created_mnth)
VALUES 
    (&#39;Scott&#39;, &#39;Tiger&#39;, &#39;scott@tiger.com&#39;, &#39;2018-10-01&#39;, 201801),
    (&#39;Donald&#39;, &#39;Duck&#39;, &#39;donald@duck.com&#39;, &#39;2019-02-10&#39;, 201902),
    (&#39;Mickey&#39;, &#39;Mouse&#39;, &#39;mickey@mouse.com&#39;, &#39;2017-06-22&#39;, 201706)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://itversity_sms_user:***@localhost:5432/itversity_sms_db
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">CheckViolation</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="nn">/opt/anaconda3/envs/beakerx/lib/python3.6/site-packages/sqlalchemy/engine/base.py</span> in <span class="ni">_execute_context</span><span class="nt">(self, dialect, constructor, statement, parameters, *args)</span>
<span class="g g-Whitespace">   </span><span class="mi">1276</span>                     <span class="bp">self</span><span class="o">.</span><span class="n">dialect</span><span class="o">.</span><span class="n">do_execute</span><span class="p">(</span>
<span class="ne">-&gt; </span><span class="mi">1277</span>                         <span class="n">cursor</span><span class="p">,</span> <span class="n">statement</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">context</span>
<span class="g g-Whitespace">   </span><span class="mi">1278</span>                     <span class="p">)</span>

<span class="nn">/opt/anaconda3/envs/beakerx/lib/python3.6/site-packages/sqlalchemy/engine/default.py</span> in <span class="ni">do_execute</span><span class="nt">(self, cursor, statement, parameters, context)</span>
<span class="g g-Whitespace">    </span><span class="mi">592</span>     <span class="k">def</span> <span class="nf">do_execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cursor</span><span class="p">,</span> <span class="n">statement</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">593</span>         <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">594</span> 

<span class="ne">CheckViolation</span>: no partition of relation &quot;users_mthly_part&quot; found for row
<span class="ne">DETAIL</span>:  Partition key of the failing row contains (created_mnth) = (201801).


<span class="n">The</span> <span class="n">above</span> <span class="n">exception</span> <span class="n">was</span> <span class="n">the</span> <span class="n">direct</span> <span class="n">cause</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">exception</span><span class="p">:</span>

<span class="ne">IntegrityError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">116</span><span class="o">-</span><span class="mi">0</span><span class="n">abf83731ae7</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">run_cell_magic</span><span class="p">(</span><span class="s1">&#39;sql&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">INSERT INTO users_mthly_part </span><span class="se">\n</span><span class="s2">    (user_first_name, user_last_name, user_email_id, created_dt, created_mnth)</span><span class="se">\n</span><span class="s2">VALUES </span><span class="se">\n</span><span class="s2">    (&#39;Scott&#39;, &#39;Tiger&#39;, &#39;scott@tiger.com&#39;, &#39;2018-10-01&#39;, 201801),</span><span class="se">\n</span><span class="s2">    (&#39;Donald&#39;, &#39;Duck&#39;, &#39;donald@duck.com&#39;, &#39;2019-02-10&#39;, 201902),</span><span class="se">\n</span><span class="s2">    (&#39;Mickey&#39;, &#39;Mouse&#39;, &#39;mickey@mouse.com&#39;, &#39;2017-06-22&#39;, 201706)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nn">/opt/anaconda3/envs/beakerx/lib/python3.6/site-packages/IPython/core/interactiveshell.py</span> in <span class="ni">run_cell_magic</span><span class="nt">(self, magic_name, line, cell)</span>
<span class="g g-Whitespace">   </span><span class="mi">2369</span>             <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">builtin_trap</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">2370</span>                 <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">magic_arg_s</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">2371</span>                 <span class="n">result</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2372</span>             <span class="k">return</span> <span class="n">result</span>
<span class="g g-Whitespace">   </span><span class="mi">2373</span> 

<span class="nn">&lt;decorator-gen-135&gt;</span> in <span class="ni">execute</span><span class="nt">(self, line, cell, local_ns)</span>

<span class="nn">/opt/anaconda3/envs/beakerx/lib/python3.6/site-packages/IPython/core/magic.py</span> in <span class="ni">&lt;lambda&gt;</span><span class="nt">(f, *a, **k)</span>
<span class="g g-Whitespace">    </span><span class="mi">185</span>     <span class="c1"># but it&#39;s overkill for just that one bit of state.</span>
<span class="g g-Whitespace">    </span><span class="mi">186</span>     <span class="k">def</span> <span class="nf">magic_deco</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">187</span>         <span class="n">call</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">:</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">188</span> 
<span class="g g-Whitespace">    </span><span class="mi">189</span>         <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>

<span class="nn">&lt;decorator-gen-134&gt;</span> in <span class="ni">execute</span><span class="nt">(self, line, cell, local_ns)</span>

<span class="nn">/opt/anaconda3/envs/beakerx/lib/python3.6/site-packages/IPython/core/magic.py</span> in <span class="ni">&lt;lambda&gt;</span><span class="nt">(f, *a, **k)</span>
<span class="g g-Whitespace">    </span><span class="mi">185</span>     <span class="c1"># but it&#39;s overkill for just that one bit of state.</span>
<span class="g g-Whitespace">    </span><span class="mi">186</span>     <span class="k">def</span> <span class="nf">magic_deco</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">187</span>         <span class="n">call</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">:</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">188</span> 
<span class="g g-Whitespace">    </span><span class="mi">189</span>         <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>

<span class="nn">/opt/anaconda3/envs/beakerx/lib/python3.6/site-packages/sql/magic.py</span> in <span class="ni">execute</span><span class="nt">(self, line, cell, local_ns)</span>
<span class="g g-Whitespace">    </span><span class="mi">215</span> 
<span class="g g-Whitespace">    </span><span class="mi">216</span>         <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">217</span>             <span class="n">result</span> <span class="o">=</span> <span class="n">sql</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">parsed</span><span class="p">[</span><span class="s2">&quot;sql&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">,</span> <span class="n">user_ns</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">218</span> 
<span class="g g-Whitespace">    </span><span class="mi">219</span>             <span class="k">if</span> <span class="p">(</span>

<span class="nn">/opt/anaconda3/envs/beakerx/lib/python3.6/site-packages/sql/run.py</span> in <span class="ni">run</span><span class="nt">(conn, sql, config, user_namespace)</span>
<span class="g g-Whitespace">    </span><span class="mi">365</span>             <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">366</span>                 <span class="n">txt</span> <span class="o">=</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">367</span>                 <span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span> <span class="n">user_namespace</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">368</span>             <span class="n">_commit</span><span class="p">(</span><span class="n">conn</span><span class="o">=</span><span class="n">conn</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">369</span>             <span class="k">if</span> <span class="n">result</span> <span class="ow">and</span> <span class="n">config</span><span class="o">.</span><span class="n">feedback</span><span class="p">:</span>

<span class="nn">/opt/anaconda3/envs/beakerx/lib/python3.6/site-packages/sqlalchemy/engine/base.py</span> in <span class="ni">execute</span><span class="nt">(self, object_, *multiparams, **params)</span>
<span class="g g-Whitespace">   </span><span class="mi">1009</span>             <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1010</span>         <span class="k">else</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1011</span>             <span class="k">return</span> <span class="n">meth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiparams</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1012</span> 
<span class="g g-Whitespace">   </span><span class="mi">1013</span>     <span class="k">def</span> <span class="nf">_execute_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">multiparams</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>

<span class="nn">/opt/anaconda3/envs/beakerx/lib/python3.6/site-packages/sqlalchemy/sql/elements.py</span> in <span class="ni">_execute_on_connection</span><span class="nt">(self, connection, multiparams, params)</span>
<span class="g g-Whitespace">    </span><span class="mi">296</span>     <span class="k">def</span> <span class="nf">_execute_on_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span> <span class="n">multiparams</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">297</span>         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">supports_execution</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">298</span>             <span class="k">return</span> <span class="n">connection</span><span class="o">.</span><span class="n">_execute_clauseelement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiparams</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">299</span>         <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">300</span>             <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ObjectNotExecutableError</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<span class="nn">/opt/anaconda3/envs/beakerx/lib/python3.6/site-packages/sqlalchemy/engine/base.py</span> in <span class="ni">_execute_clauseelement</span><span class="nt">(self, elem, multiparams, params)</span>
<span class="g g-Whitespace">   </span><span class="mi">1128</span>             <span class="n">distilled_params</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1129</span>             <span class="n">compiled_sql</span><span class="p">,</span>
<span class="ne">-&gt; </span><span class="mi">1130</span>             <span class="n">distilled_params</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1131</span>         <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1132</span>         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_events</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">_has_events</span><span class="p">:</span>

<span class="nn">/opt/anaconda3/envs/beakerx/lib/python3.6/site-packages/sqlalchemy/engine/base.py</span> in <span class="ni">_execute_context</span><span class="nt">(self, dialect, constructor, statement, parameters, *args)</span>
<span class="g g-Whitespace">   </span><span class="mi">1315</span>         <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1316</span>             <span class="bp">self</span><span class="o">.</span><span class="n">_handle_dbapi_exception</span><span class="p">(</span>
<span class="ne">-&gt; </span><span class="mi">1317</span>                 <span class="n">e</span><span class="p">,</span> <span class="n">statement</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">cursor</span><span class="p">,</span> <span class="n">context</span>
<span class="g g-Whitespace">   </span><span class="mi">1318</span>             <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1319</span> 

<span class="nn">/opt/anaconda3/envs/beakerx/lib/python3.6/site-packages/sqlalchemy/engine/base.py</span> in <span class="ni">_handle_dbapi_exception</span><span class="nt">(self, e, statement, parameters, cursor, context)</span>
<span class="g g-Whitespace">   </span><span class="mi">1509</span>             <span class="k">elif</span> <span class="n">should_wrap</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1510</span>                 <span class="n">util</span><span class="o">.</span><span class="n">raise_</span><span class="p">(</span>
<span class="ne">-&gt; </span><span class="mi">1511</span>                     <span class="n">sqlalchemy_exception</span><span class="p">,</span> <span class="n">with_traceback</span><span class="o">=</span><span class="n">exc_info</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">from_</span><span class="o">=</span><span class="n">e</span>
<span class="g g-Whitespace">   </span><span class="mi">1512</span>                 <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1513</span>             <span class="k">else</span><span class="p">:</span>

<span class="nn">/opt/anaconda3/envs/beakerx/lib/python3.6/site-packages/sqlalchemy/util/compat.py</span> in <span class="ni">raise_</span><span class="nt">(***failed resolving arguments***)</span>
<span class="g g-Whitespace">    </span><span class="mi">180</span> 
<span class="g g-Whitespace">    </span><span class="mi">181</span>         <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">182</span>             <span class="k">raise</span> <span class="n">exception</span>
<span class="g g-Whitespace">    </span><span class="mi">183</span>         <span class="k">finally</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">184</span>             <span class="c1"># credit to</span>

<span class="nn">/opt/anaconda3/envs/beakerx/lib/python3.6/site-packages/sqlalchemy/engine/base.py</span> in <span class="ni">_execute_context</span><span class="nt">(self, dialect, constructor, statement, parameters, *args)</span>
<span class="g g-Whitespace">   </span><span class="mi">1275</span>                 <span class="k">if</span> <span class="ow">not</span> <span class="n">evt_handled</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1276</span>                     <span class="bp">self</span><span class="o">.</span><span class="n">dialect</span><span class="o">.</span><span class="n">do_execute</span><span class="p">(</span>
<span class="ne">-&gt; </span><span class="mi">1277</span>                         <span class="n">cursor</span><span class="p">,</span> <span class="n">statement</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">context</span>
<span class="g g-Whitespace">   </span><span class="mi">1278</span>                     <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1279</span> 

<span class="nn">/opt/anaconda3/envs/beakerx/lib/python3.6/site-packages/sqlalchemy/engine/default.py</span> in <span class="ni">do_execute</span><span class="nt">(self, cursor, statement, parameters, context)</span>
<span class="g g-Whitespace">    </span><span class="mi">591</span> 
<span class="g g-Whitespace">    </span><span class="mi">592</span>     <span class="k">def</span> <span class="nf">do_execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cursor</span><span class="p">,</span> <span class="n">statement</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">593</span>         <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">594</span> 
<span class="g g-Whitespace">    </span><span class="mi">595</span>     <span class="k">def</span> <span class="nf">do_execute_no_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cursor</span><span class="p">,</span> <span class="n">statement</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

<span class="ne">IntegrityError</span>: (psycopg2.errors.CheckViolation) no partition of relation &quot;users_mthly_part&quot; found for row
<span class="ne">DETAIL</span>:  Partition key of the failing row contains (created_mnth) = (201801).

<span class="p">[</span><span class="n">SQL</span><span class="p">:</span> <span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">users_mthly_part</span> <span class="p">(</span><span class="n">user_first_name</span><span class="p">,</span> <span class="n">user_last_name</span><span class="p">,</span> <span class="n">user_email_id</span><span class="p">,</span> <span class="n">created_dt</span><span class="p">,</span> <span class="n">created_mnth</span><span class="p">)</span>
<span class="n">VALUES</span> 
    <span class="p">(</span><span class="s1">&#39;Scott&#39;</span><span class="p">,</span> <span class="s1">&#39;Tiger&#39;</span><span class="p">,</span> <span class="s1">&#39;scott@tiger.com&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-10-01&#39;</span><span class="p">,</span> <span class="mi">201801</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;Donald&#39;</span><span class="p">,</span> <span class="s1">&#39;Duck&#39;</span><span class="p">,</span> <span class="s1">&#39;donald@duck.com&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-02-10&#39;</span><span class="p">,</span> <span class="mi">201902</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;Mickey&#39;</span><span class="p">,</span> <span class="s1">&#39;Mouse&#39;</span><span class="p">,</span> <span class="s1">&#39;mickey@mouse.com&#39;</span><span class="p">,</span> <span class="s1">&#39;2017-06-22&#39;</span><span class="p">,</span> <span class="mi">201706</span><span class="p">)]</span>
<span class="p">(</span><span class="n">Background</span> <span class="n">on</span> <span class="n">this</span> <span class="n">error</span> <span class="n">at</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">sqlalche</span><span class="o">.</span><span class="n">me</span><span class="o">/</span><span class="n">e</span><span class="o">/</span><span class="mi">13</span><span class="o">/</span><span class="n">gkpj</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="adding-partitions">
<h2>Adding Partitions<a class="headerlink" href="#adding-partitions" title="Permalink to this headline">¶</a></h2>
<p>Let us see how we can add partitions to existing table which is created using list partitioning strategy.</p>
<ul class="simple">
<li><p>We can create partition by using <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">TABLE</span> <span class="pre">&lt;partition_name&gt;</span> <span class="pre">PARTITION</span> <span class="pre">OF</span> <span class="pre">&lt;table_name&gt;</span></code> syntax.</p></li>
<li><p>We can have a partition for default values so that all the data that does not satisfy the condition can be added to it.</p></li>
<li><p>We can have a partition for each value or for a set of values.</p></li>
<li><p>Once partitions are added, we can insert data into it.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

CREATE TABLE users_mthly_part_default
PARTITION OF users_mthly_part DEFAULT
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://itversity_sms_user:***@localhost:5432/itversity_sms_db
Done.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

CREATE TABLE users_mthly_part_201801 
PARTITION OF users_mthly_part  
FOR VALUES IN (201801)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://itversity_sms_user:***@localhost:5432/itversity_sms_db
Done.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

CREATE TABLE users_mthly_part_201902
PARTITION OF users_mthly_part  
FOR VALUES IN (201902)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://itversity_sms_user:***@localhost:5432/itversity_sms_db
Done.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

CREATE TABLE users_mthly_part_201706
PARTITION OF users_mthly_part  
FOR VALUES IN (201706)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://itversity_sms_user:***@localhost:5432/itversity_sms_db
Done.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="inserting-data">
<h2>Inserting Data<a class="headerlink" href="#inserting-data" title="Permalink to this headline">¶</a></h2>
<p>Let us understand how we can insert data into a partitioned table.</p>
<ul class="simple">
<li><p>We need to ensure at least default partition is added.</p></li>
<li><p>On top of default partition, make sure to have other desired partitions added.</p></li>
<li><p>We can insert into the table or directly into the partition.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

INSERT INTO users_mthly_part 
    (user_first_name, user_last_name, user_email_id, created_dt, created_mnth)
VALUES 
    (&#39;Scott&#39;, &#39;Tiger&#39;, &#39;scott@tiger.com&#39;, &#39;2018-10-01&#39;, 201801),
    (&#39;Donald&#39;, &#39;Duck&#39;, &#39;donald@duck.com&#39;, &#39;2019-02-10&#39;, 201902)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://itversity_sms_user:***@localhost:5432/itversity_sms_db
2 rows affected.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

SELECT user_first_name, user_last_name, user_email_id, created_dt, created_mnth
FROM users_mthly_part
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://itversity_sms_user:***@localhost:5432/itversity_sms_db
2 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <tr>
        <th>user_first_name</th>
        <th>user_last_name</th>
        <th>user_email_id</th>
        <th>created_dt</th>
        <th>created_mnth</th>
    </tr>
    <tr>
        <td>Scott</td>
        <td>Tiger</td>
        <td>scott@tiger.com</td>
        <td>2018-10-01</td>
        <td>201801</td>
    </tr>
    <tr>
        <td>Donald</td>
        <td>Duck</td>
        <td>donald@duck.com</td>
        <td>2019-02-10</td>
        <td>201902</td>
    </tr>
</table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

INSERT INTO users_mthly_part_201706
    (user_first_name, user_last_name, user_email_id, created_dt, created_mnth)
VALUES 
    (&#39;Mickey&#39;, &#39;Mouse&#39;, &#39;mickey@mouse.com&#39;, &#39;2017-06-22&#39;, 201706)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://itversity_sms_user:***@localhost:5432/itversity_sms_db
1 rows affected.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

SELECT user_first_name, user_last_name, user_email_id, created_dt, created_mnth
FROM users_mthly_part
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://itversity_sms_user:***@localhost:5432/itversity_sms_db
3 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <tr>
        <th>user_first_name</th>
        <th>user_last_name</th>
        <th>user_email_id</th>
        <th>created_dt</th>
        <th>created_mnth</th>
    </tr>
    <tr>
        <td>Mickey</td>
        <td>Mouse</td>
        <td>mickey@mouse.com</td>
        <td>2017-06-22</td>
        <td>201706</td>
    </tr>
    <tr>
        <td>Scott</td>
        <td>Tiger</td>
        <td>scott@tiger.com</td>
        <td>2018-10-01</td>
        <td>201801</td>
    </tr>
    <tr>
        <td>Donald</td>
        <td>Duck</td>
        <td>donald@duck.com</td>
        <td>2019-02-10</td>
        <td>201902</td>
    </tr>
</table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

SELECT user_first_name, user_last_name, user_email_id, created_dt, created_mnth
FROM users_mthly_part_201706
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://itversity_sms_user:***@localhost:5432/itversity_sms_db
1 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <tr>
        <th>user_first_name</th>
        <th>user_last_name</th>
        <th>user_email_id</th>
        <th>created_dt</th>
        <th>created_mnth</th>
    </tr>
    <tr>
        <td>Mickey</td>
        <td>Mouse</td>
        <td>mickey@mouse.com</td>
        <td>2017-06-22</td>
        <td>201706</td>
    </tr>
</table></div></div>
</div>
</div>
<div class="section" id="dropping-partitions">
<h2>Dropping Partitions<a class="headerlink" href="#dropping-partitions" title="Permalink to this headline">¶</a></h2>
<p>Let us understand how we can drop partitions from a partitioned table.</p>
<ul class="simple">
<li><p>We just need to drop the partition similar to dropping a table.</p></li>
<li><p>Here is the syntax - <code class="docutils literal notranslate"><span class="pre">DROP</span> <span class="pre">TABLE</span> <span class="pre">&lt;table_for_partition&gt;</span></code></p></li>
<li><p>One can also detach partition instead of dropping it. It is useful in case of taking the back up of partitions before dropping it.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

DROP TABLE users_mthly_part_201706
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

SELECT user_first_name, user_last_name, user_email_id, created_dt, created_mnth
FROM users_mthly_part
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="managing-indexes">
<h2>Managing Indexes<a class="headerlink" href="#managing-indexes" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

SELECT *
FROM pg_catalog.pg_indexes
WHERE tablename = &#39;users_mthly_part&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

CREATE INDEX users_mthly_part_idx1
ON users_mthly_part(created_dt)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

SELECT *
FROM pg_catalog.pg_indexes
WHERE tablename = &#39;users_mthly_part&#39;
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="range-partitioning">
<h2>Range Partitioning<a class="headerlink" href="#range-partitioning" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">sql</span> DROP TABLE IF EXISTS users_range_part
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

CREATE TABLE users_range_part (
    user_id SERIAL,
    user_first_name VARCHAR(30) NOT NULL,
    user_last_name VARCHAR(30) NOT NULL,
    user_email_id VARCHAR(50) NOT NULL,
    user_email_validated BOOLEAN DEFAULT FALSE,
    user_password VARCHAR(200),
    user_role VARCHAR(1) NOT NULL DEFAULT &#39;U&#39;, --U and A
    is_active BOOLEAN DEFAULT FALSE,
    created_dt DATE DEFAULT CURRENT_DATE,
    last_updated_ts TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (created_dt, user_id)
) PARTITION BY RANGE(created_dt)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

CREATE TABLE users_range_part_default
PARTITION OF users_range_part DEFAULT
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

CREATE TABLE users_range_part_2017
PARTITION OF users_range_part
FOR VALUES FROM (&#39;2017-01-01&#39;) TO (&#39;2017-12-31&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

CREATE TABLE users_range_part_2018
PARTITION OF users_range_part
FOR VALUES FROM (&#39;2018-01-01&#39;) TO (&#39;2018-12-31&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

CREATE TABLE users_range_part_2019
PARTITION OF users_range_part
FOR VALUES FROM (&#39;2019-01-01&#39;) TO (&#39;2019-12-31&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

CREATE TABLE users_range_part_2020
PARTITION OF users_range_part
FOR VALUES FROM (&#39;2020-01-01&#39;) TO (&#39;2020-12-31&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

INSERT INTO users_range_part 
    (user_first_name, user_last_name, user_email_id, created_dt)
VALUES 
    (&#39;Scott&#39;, &#39;Tiger&#39;, &#39;scott@tiger.com&#39;, &#39;2018-10-01&#39;),
    (&#39;Donald&#39;, &#39;Duck&#39;, &#39;donald@duck.com&#39;, &#39;2019-02-10&#39;),
    (&#39;Mickey&#39;, &#39;Mouse&#39;, &#39;mickey@mouse.com&#39;, &#39;2017-06-22&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

SELECT user_first_name, user_last_name, user_email_id, created_dt
FROM users_range_part_default
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

SELECT user_first_name, user_last_name, user_email_id, created_dt
FROM users_range_part_2017
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

SELECT user_first_name, user_last_name, user_email_id, created_dt
FROM users_range_part_2018
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

SELECT user_first_name, user_last_name, user_email_id, created_dt
FROM users_range_part_2019
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

SELECT user_first_name, user_last_name, user_email_id, created_dt
FROM users_range_part_2020
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="hash-partitioning">
<h2>Hash Partitioning<a class="headerlink" href="#hash-partitioning" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="usage-scenarios">
<h2>Usage Scenarios<a class="headerlink" href="#usage-scenarios" title="Permalink to this headline">¶</a></h2>
<p>Let us go through some of the usage scenarios with respect to partitioning.</p>
<ul class="simple">
<li><p>It is typically used to manage large tables so that the tables does not grow abnormally large over a period of time.</p></li>
<li><p>Paritioning is quite often used on top of log tables, reporting tables etc.</p></li>
<li><p>If a log table is partitioned and if we want to have data for 7 years, partitions older than 7 years can be quickly dropped.</p></li>
<li><p>Dropping partittions to clean up huge chunk of data is much faster compared to running delete command on non partitioned table.</p></li>
<li><p>For tables like orders with limited set of statuses, we often use list partitioning based up on the status. It can be 2 partitions (CLOSED orders and ACTIVE orders) or separate partition for each status.</p>
<ul>
<li><p>As most of the operations will be on <strong>Active Orders</strong>, this approach can significantly improve the performance.</p></li>
</ul>
</li>
<li><p>In case of log tables, where we might want to retain data for several years, we tend to use range partition on date column. If we use list partition, then we might end up in duplication of data unnecessarily.</p></li>
</ul>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="04_creating_tables_and_indexes.html" title="previous page">Creating Tables and Indexes</a>
    <a class='right-next' id="next-link" href="06_predefined_functions.html" title="next page">Pre-Defined Functions</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By The Jupyter Book community<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>